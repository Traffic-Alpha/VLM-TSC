<!--
 * @Author: Maonan Wang
 * @Date: 2025-01-13 19:24:39
 * @LastEditTime: 2025-04-15 19:33:27
 * @LastEditors: Maonan Wang
 * @Description: VLM for TSC
 * @FilePath: /VLM-TSC/README.md
-->
# 版本一

1. 使用 AI Agents 的想法 (看一下自动驾驶 AI Agents 的想法)
2. 三个单路口的场景

# 版本二

1. 存在特殊 Traffic Phase, 这个 Phase 是专门给 VLM 使用的, 平时的 Traffic Phase 都是给 RL 来使用的

# 版本三

1. 多路口, 可以有车辆协同的效果, 或者不同路口的 AI Agenst 协同的效果


---

## 如何运行

1. 首先我们运行 `collect_state_rl.py` 文件收集仿真环境的图像和具体车辆的位置；
2. 接着运行 `json_to_templated.py` 将格式化数据转换为 QA 问题，注意这里是基于模板生成的 QA 数据对；

---

- 基于 state 的 TSC
- 基于 pixel 的 TSC

- 将车辆的模型通过 release 上传，然后放在文件夹
- 构建一个稍微复杂的车流，可以出现堵车，且可以在 3D 的效果里面看到
- 使用 state rl 跑通, 然后在 image 里面收集数据
- 是否可以构造车辆撞车的图像

---

可以识别到有特殊的车辆（救护车，警车）
可以识别到撞车（SUMO 中通过设置车辆位置，让车辆进行撞车）
当出现数据丢失的时候

---
- 传感器的图片保存为 1080P 的结果
- 传感器数据有四个方向的摄像头 + 俯视的角度
- 可以指定将传感器添加到某个 object 上面
- 提升传感器输出图像的质量


## 需要做的任务

- [TODO] 制作一个可以手动控制信号灯的代码，根据传感器数据手动控制信号灯
- [TODO] 生成的时候加入日志
- [TODO] 将 json 转换为 templated, 转换的结果需要是 JSON 的格式
- [TODO] 检查生成的文本和图片是否可以对应上, 特别是每一个车道的数量和图片是否可以对应
- [TODO] 可以将序号转换为更加口语的模板，例如从左到右，从右到左这种叫法, 对 QA 做进一步的优化
- [TODO] 构造数据集的时候特意构造特殊的场景（例如警车，撞车，传感器失灵带有马赛克等）, 构造的数据集中包含上面特殊的场景
- [TODO] 需要确保车辆的长度是合适的，调整车辆的长度

## 模板的问题

- 定性问题
1. 图片中包含哪些类型的车辆（小轿车、警车，救护车）；
2. 图片中是否包含警车/救护车；
3. 图片中是否存在交通事故；
4. 在这张照片中，Incoming lane 的第 N 个车道和第 M 个车道上，哪个车道的占用率更高？
5. 指定车道（使用 Incoming 和 Outgoing，的第几个车道）是否为空？
- 定量问题：
1. 图片中有多少车道（income and outgoing）；
2. 这张照片中有多少辆车辆？
3. 指定车道上有多少辆车（在可见范围内的车辆）？
- 综合问题（开放性问题）
1. 当前场景中是否存在车辆排队现象（通过车道内车辆的密集度推断）？
2. 这张照片中是否存在交通拥堵现象？如果有，拥堵的程度如何？有/没有；轻度、中度、重度。

## 问题

1. 如果按照 LLM 的方式去微调，他可能只着重于句子，但是对关键的车辆数等回答不正确。因为数字只占一个句子中很小的一部分。
2. 是否需要保留综合问题，因为综合问题比如判断是否拥堵的 threshold 是我们自己设置的（获取要将综合问题修改为不同方向结果的比较）--> 对于问题的探讨
3. 关于车道的顺序问题，是否可以理解从左往右，从右往左的句子
4. 是否需要遍历生成所有的问题，例如将每个车道的车辆数询问一次，还是只是随机车道号从而进行询问

## ChangeLog

- 2025/03/31, 解析 SUMO 产生的 JSON 文件，将其转换为基于模板的 QA 问题对。